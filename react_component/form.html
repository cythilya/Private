<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>ReactJS Form</title>
<link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="skin/validationEngine.jquery.css">
<link rel="stylesheet" href="skin/style.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.12.1/react.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/react/0.12.1/JSXTransformer.js"></script>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/showdown/0.3.1/showdown.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/jquery.validationEngine.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jQuery-Validation-Engine/2.6.4/languages/jquery.validationEngine-zh_TW.js"></script>
</head>
<body>
<div id="example"></div>
<script type="text/jsx">
/** @jsx React.DOM */
var data = [
    {
        "heading": "item 1",
        "type": "text",
        "required": true,
		"placeholder" : "Enter text item1 here..."
    },
    {
        "heading": "item 2",
        "type": "text",
        "required": false,
		"placeholder" : "Enter text item2 here..."
    },
    {
        "heading": "item 3",
        "type": "dropdown",
        "required": true,
        "options" : [
            {
                label: "op1",
                value: "1"
            },
            {
                label: "op2",
                value: "2"
            },
            {
                label: "op3",
                value: "3"
            }                
        ]
    },
    {
        "heading": "item 4",
        "type": "radio",
        "required": false,
        "options" : [
            {
                label: "op5",
                value: "5"
            },
            {
                label: "op6",
                value: "6"
            },
            {
                label: "op7",
                value: "7"
            }                
        ]
    },
    {
        "heading": "item 8",
        "type": "checkbox",
        "required": true,
        "options" : [
            {
                label: "op9",
                value: "9"
            },
            {
                label: "op10",
                value: "10"
            },
            {
                label: "op11",
                value: "11"
            }                
        ]
    },
    {
        "heading": "item 12",
        "type": "datepicker",
        "required": true,
		"placeholder" : "Pick a date..."
    }	
];

//input text
var Text = React.createClass({
	render: function(){
		var textNode = this.props.data.map(function (item) {
			if(item.required){
				return <input className="text-item validate[required]" placeholder={item.placeholder} />
			}
			else{
				return <input className="text-item" placeholder={item.placeholder} />
			}
		});
		return(
			<div>
				{textNode}
			</div>
		);
	}
});

//dropdown
var Dropdown = React.createClass({
	render: function () {
		var selectNodes = this.props.data.map(function (item) {
			return <DropdownOption data={item.options}></DropdownOption>
		});	
		return (
			<select className="dropdown-item">
				{selectNodes}
			</select>
		);
	}
});

var DropdownOption = React.createClass({
	render: function(){
		var optionNodes = this.props.data.map(function (item) {
			return <option value={item.value}>{item.label}</option>
		});		
		return (
			<div>
				{optionNodes}
			</div>
		);
	}
});

//checkbox
var CheckboxList = React.createClass({
	render: function () {
		var checkboxNodes = this.props.data.map(function (item) {
			return <CheckboxOption data={item.options}></CheckboxOption>
		});	
		return (
			<div className="checkbox-item">
				{checkboxNodes}
			</div>
		);
	}
});

var CheckboxOption = React.createClass({
	render: function(){
		var optionNodes = this.props.data.map(function (item) {
			return <label for="{item.value}"><input id={item.value} type="checkbox" value={item.value} />{item.label}</label>
		});		
		return (
			<span>
				{optionNodes}
			</span>
		);
	}
});

//datepicker
var DatepickerInput = React.createClass({
    handleDatePickerChange: function (eventArgs){
        console.log("handleDatePickerChange-onChangeTextBox:" + eventArgs.target.value );
    },
    componentDidMount: function () {
            var textBoxId = "TextBox";
            var minDate = new Date();
            $("#" + textBoxId).datepicker({
                onSelect: function(date){
                    console.log("onSelectDatePicker date:"+date);
            },
            showOn: 'button',
            buttonText: 'Show Date',
            buttonImageOnly: true,
            buttonImage: 'http://i1375.photobucket.com/albums/ag446/eowyn_g/Work/icon_calendar_zpse819d8d4.gif',
            minDate: minDate
        });
        $('.ui-datepicker-trigger').each(function (index){
            $(this).insertBefore( $(this).prev('input') );
        });
        $("#" + textBoxId).datepicker('setDate', new Date());
    },   
    render: function() {
        console.log("render datepicker");
        return (
            <div>
                <input type='text' id="TextBox" onChange={this.handleDatePickerChange}/>
            </div>
        );
    }
});

var FormBox = React.createClass({
	handleSubmit: function(){
		var result = $('.form-box').validationEngine('validate');
		
		if(result){
			//alert('Submit');
			console.log('send data');
		}
		
		return false;
	},
	render: function(){
		var formNodes = this.props.data.map(function (item) {
			var type = item.type;
		
			switch(type) {
				case 'text':
					var textList = [];
					if(item.type == 'text'){
						textList.push(item);
					}
					return <li><Text data={textList} /></li>;
					break;
				case 'dropdown':
					var dropdownList = [];
					if(item.type == 'dropdown'){
						dropdownList.push(item);
					}				
					return <li><Dropdown data={dropdownList} /></li>;
					break;
				case 'checkbox':
					var checkboxList = [];
					if(item.type == 'checkbox'){
						checkboxList.push(item);
					}				
					return <li><CheckboxList data={checkboxList} /></li>;
					break;
				case 'datepicker':
					var datepickerList = [];
					if(item.type == 'datepicker'){
						datepickerList.push(item);
					}
					return <li><DatepickerInput data={datepickerList} /></li>;
					break;
				default:
					return;
					break;
			}	
		});
		
		return(
			<form className="form-box" onSubmit={this.handleSubmit}>
				<ul>
					{formNodes}
				</ul>
				<input type="submit" value="send" />
			</form>
		);
	}
});

React.renderComponent(
	<FormBox data={data} />,
	document.getElementById('example')
);
</script>
</body>
</html>